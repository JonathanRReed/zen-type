@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --rp-base: #191724;
  --rp-surface: #1f1d2e;
  --rp-overlay: #26233a;
  --rp-muted: #6e6a86;
  --rp-subtle: #908caa;
  --rp-text: #e0def4;
  --rp-love: #eb6f92;
  --rp-gold: #f6c177;
  --rp-rose: #ea9a97;
  --rp-pine: #3e8fb0;
  --rp-foam: #9ccfd8;
  --rp-iris: #c4a7e7;
  --rp-hi-low: #21202e;
  --rp-hi-med: #403d52;
  --rp-hi-high: #524f67;
  --shadow-soft: 0 8px 30px rgba(0,0,0,.35);
  --blur: 12px;
  --ease-smooth: cubic-bezier(0.22, 1, 0.36, 1);
  /* Default ambient gradient (Rosé Pine on OLED-dark) */
  --theme-gradient: linear-gradient(180deg, var(--rp-base) 0%, var(--rp-overlay) 100%);
  --theme-gradient-angle: 180deg;
  --theme-gradient-center-x: 50%;
  --theme-gradient-center-y: 50%;
  --theme-hue-shift: 0deg;
}

html {
  color-scheme: dark;
}

body {
  background: var(--theme-gradient, var(--rp-base));
  color: var(--rp-text);
  font-family: theme('fontFamily.sans');
  margin: 0;
  padding: 0;
  min-height: 100vh;
  transition: opacity .2s var(--ease-smooth), transform .2s var(--ease-smooth);
}

.glass {
  background: color-mix(in oklab, var(--rp-surface) 80%, transparent);
  backdrop-filter: blur(var(--blur));
  box-shadow: var(--shadow-soft);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 12%, transparent);
}

/* High contrast mode */
html.high-contrast .glass {
  background: color-mix(in oklab, var(--rp-surface) 92%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 35%, transparent);
}
html.high-contrast :focus-visible {
  outline: 3px solid var(--rp-iris);
  outline-offset: 2px;
}

.caret {
  width: 2px;
  animation: blink 0.7s step-end infinite;
}

/* Accent caret for inputs */
.caret-accent { caret-color: var(--rp-iris); }

/* Vignette overlay to add depth on scenes */
.vignette {
  background: radial-gradient(ellipse at center, rgba(0,0,0,0) 60%, rgba(0,0,0,0.32) 100%);
}

/* Ghost buttons (header micro-controls) */
.button-ghost {
  background: color-mix(in oklab, var(--rp-overlay) 55%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 18%, transparent);
  color: var(--rp-subtle);
  transition: background .2s var(--ease-smooth), color .2s var(--ease-smooth), border-color .2s var(--ease-smooth);
}
.button-ghost:hover {
  background: color-mix(in oklab, var(--rp-overlay) 75%, transparent);
  color: var(--rp-text);
  border-color: color-mix(in oklab, var(--rp-iris) 32%, transparent);
}

/* Focus-visible accessibility ring across interactive elements */
:where(a, button, [role="button"], input, select, textarea, [tabindex]):focus-visible {
  outline: 2px solid color-mix(in oklab, var(--rp-iris) 70%, transparent);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px color-mix(in oklab, var(--rp-iris) 18%, transparent);
}

/* Cards: subtle hover animation and glow */
.card {
  @apply rounded-2xl;
  background: color-mix(in oklab, var(--rp-surface) 80%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 14%, transparent);
  backdrop-filter: blur(var(--blur));
  box-shadow: var(--shadow-soft);
  transition: transform .2s var(--ease-smooth), background .2s var(--ease-smooth), border-color .2s var(--ease-smooth), box-shadow .2s var(--ease-smooth);
}
.card:hover, .card:focus-visible {
  transform: translateY(-2px) scale(1.01);
  border-color: color-mix(in oklab, var(--rp-iris) 26%, transparent);
  box-shadow: 0 10px 36px rgba(0,0,0,.4);
}

/* Context-aware highlights using :has() (scoped for supporting browsers) */
@supports selector(:has(*)) {
  .glass:has(input:focus-visible),
  .glass:has(textarea:focus-visible),
  .card:has(:focus-visible) {
    border-color: color-mix(in oklab, var(--rp-iris) 28%, transparent);
    box-shadow: 0 0 0 6px color-mix(in oklab, var(--rp-iris) 12%, transparent), var(--shadow-soft);
  }
}

/* Scroll snap utilities (used by Archive overlay lists) */
.snap-y { scroll-snap-type: y proximity; }
.snap-x { scroll-snap-type: x proximity; }
.snap-mandatory { scroll-snap-type: y mandatory; }
.snap-item { scroll-snap-align: start; }

/* Container queries for StatsBar responsive placement */
.stats-cq { container-type: inline-size; }
@container (max-width: 560px) {
  .stats-bar { left: auto; right: 1rem; transform: none; bottom: 1rem; }
  .stats-bar .glass { padding: .5rem .75rem; }
}
@container (min-width: 1000px) {
  .stats-bar .glass { gap: 2rem; }
}

/* Page transitions */
html.page-enter body { opacity: 0.001; transform: translateY(6px); }
html.page-exit body { opacity: 0; transform: translateY(-6px); }

/* Lightweight grain overlay */
.grain {
  background-image:
    radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(rgba(0,0,0,0.04) 1px, transparent 1px);
  background-size: 2px 2px, 3px 3px;
  background-position: 0 0, 1px 1px;
  opacity: .25;
  mix-blend-mode: soft-light;
}

/* Theme base layer */
.theme-layer {
  background: var(--theme-gradient, linear-gradient(180deg, var(--rp-base), var(--rp-overlay)));
  filter: none;
}

/* Keyframes */
@keyframes forestBreath90 {
  0%,100% {
    background-position: 50% 52%, 16% -6%, 82% -10%, 50% 100%;
    filter: saturate(0.96);
  }
  50% {
    background-position: 52% 49%, 18% -4%, 80% -8%, 50% 102%;
    filter: saturate(1.04);
  }
}
@keyframes leafGlide90 {
  0% {
    background-position: 15% -15%, 42% -20%, 65% -12%, 85% -18%;
    opacity: 0;
  }
  10% {
    opacity: .05;
  }
  50% {
    background-position: 18% 45%, 45% 40%, 62% 48%, 82% 42%;
    opacity: .04;
  }
  90% {
    opacity: .02;
  }
  100% {
    background-position: 20% 110%, 48% 108%, 58% 112%, 78% 110%;
    opacity: 0;
  }
}
@keyframes oceanDrift90 {
  0%,100% {
    background-position: 50% 52%, 50% 50%, 50% 48%;
  }
  50% {
    background-position: 48% 50%, 52% 49%, 50% 51%;
  }
}
@keyframes oceanBubble30 {
  0% {
    background-position: 20% 110%, 60% 115%, 85% 112%;
    opacity: 0;
  }
  5% {
    opacity: .6;
  }
  50% {
    background-position: 22% 55%, 62% 58%, 83% 52%;
    opacity: .5;
  }
  95% {
    opacity: .3;
  }
  100% {
    background-position: 24% -5%, 64% -8%, 81% -10%;
    opacity: 0;
  }
}
@keyframes horizonShimmer15 {
  0%,100% {
    opacity: .35;
    transform: translateY(0);
  }
  50% {
    opacity: .45;
    transform: translateY(-0.5%);
  }
}
@keyframes cosmicHue120 {
  0%,100% {
    filter: hue-rotate(0deg) saturate(1);
  }
  50% {
    filter: hue-rotate(2deg) saturate(1.03);
  }
}
@keyframes cosmicTwinkle25 {
  0%,100% {
    opacity: .45;
  }
  25% {
    opacity: .65;
  }
  50% {
    opacity: .35;
  }
  75% {
    opacity: .55;
  }
}
@keyframes cosmicComet120 {
  0% {
    opacity: 0;
    transform: translate3d(-20%, -12%, 0) rotate(22deg);
  }
  2% {
    opacity: .15;
  }
  5% {
    opacity: .08;
    transform: translate3d(120%, 15%, 0) rotate(22deg);
  }
  100% {
    opacity: 0;
    transform: translate3d(120%, 15%, 0) rotate(22deg);
  }
}
@keyframes plainScroll150 {
  0% {
    background-position: 50% 0%;
  }
  100% {
    background-position: 50% 5%;
  }
}

/* Forest: True greens with Rosé Pine harmony and organic overlays */
html.theme-forest {
  --forest-0: #0e1914;
  --forest-1: #13231a;
  --forest-2: #1b3628;
  --forest-3: #284936;
  --moss: #7fbf9e;
  --leaf: #a3d9b1;
  --pine-mix: color-mix(in oklab, var(--rp-pine) 25%, #1b3628 75%);
}
html.theme-forest .theme-layer {
  --bg-a: var(--forest-1);
  --bg-b: var(--forest-3);
  background:
    radial-gradient(120% 80% at 50% -10%, color-mix(in oklab, var(--bg-b) 65%, #000 35%), var(--bg-a)),
    linear-gradient(180deg, var(--bg-a), var(--bg-b));
}
/* Organic grain overlay */
html.theme-forest .theme-layer::before {
  content:""; position:absolute; inset:0; pointer-events:none;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" opacity=".06"><filter id="n"><feTurbulence baseFrequency=".9" numOctaves="1"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
  mix-blend-mode: soft-light;
}
/* Gentle breathing gradient */
html.theme-forest[data-motion="on"] .theme-layer::after {
  content:""; position:absolute; inset:-10%; pointer-events:none;
  background: radial-gradient(120% 80% at 50% 60%, transparent, color-mix(in oklab,var(--moss) 8%, transparent));
  animation: forest-breathe 90s ease-in-out infinite;
}
@keyframes forest-breathe { 50% { filter: brightness(1.05); } }
/* Remove dotted wallpaper for Forest */
html.theme-forest .grain { background: none !important; opacity: 0 !important; }

/* Ocean: Deep blues with seafoam accents and wave shimmer */
html.theme-ocean {
  --ocean-0: #07131e;
  --ocean-1: #0a2436;
  --ocean-2: #0f3a57;
  --ocean-3: #145275;
  --seafoam: #9ccfd8;
  --deep: #082031;
}
html.theme-ocean .theme-layer {
  background:
    radial-gradient(120% 90% at 50% -20%, var(--ocean-2), var(--ocean-0)),
    linear-gradient(180deg, var(--ocean-1), var(--ocean-3));
}
/* Wave shimmer (motion only) */
html.theme-ocean[data-motion="on"] .theme-layer::before {
  content:""; position:absolute; inset:0; pointer-events:none;
  background: conic-gradient(from 180deg at 50% 60%,
              color-mix(in oklab,var(--seafoam) 6%, transparent),
              transparent 20%, color-mix(in oklab,var(--seafoam) 4%, transparent) 40%, transparent);
  opacity:.35; mix-blend-mode: screen;
  animation: ocean-wave 12s ease-in-out infinite;
}
@keyframes ocean-wave { 
  50% { transform: translateY(-2%) scaleY(1.02); filter: blur(1.5px); }
}
/* Horizon shimmer band at ~15% height */
html.theme-ocean .theme-layer::after {
  content:""; position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
  background-size: 100% 15%;
  background-position: 0 15%;
  background-repeat: no-repeat;
}
/* Remove dotted wallpaper for Ocean */
html.theme-ocean .grain { background: none !important; opacity: 0 !important; }

/* Cosmic: Dark violet/black base with Rosé Pine accents */
html.theme-cosmic .theme-layer {
  background-image:
    radial-gradient(ellipse 110% 70% at 50% 25%, color-mix(in oklab, var(--rp-iris) 20%, #0a0014 80%) 0%, transparent 65%),
    radial-gradient(ellipse 90% 45% at 50% 85%, color-mix(in oklab, #120825 85%, var(--rp-iris) 15%) 0%, transparent 55%),
    var(--theme-gradient, radial-gradient(ellipse at 50% 50%, #0a0014, #120825, #050008));
  background-size: 140% 140%, 100% 100%, 100% 100%;
  background-position: 50% 50%, 50% 100%, 50% 50%;
  filter: saturate(0.98) hue-rotate(var(--theme-hue-shift, 0deg));
  animation: cosmicHue120 120s ease-in-out infinite;
}
html.theme-cosmic .theme-layer::before {
  content:""; position:absolute; inset:0; pointer-events:none;
  /* Starfield: fewer, brighter dots that twinkle slowly */
  background-image:
    radial-gradient(2px 2px at 22% 28%, rgba(255,255,255,0.9) 45%, transparent 55%),
    radial-gradient(1.8px 1.8px at 45% 65%, rgba(255,255,255,0.95) 45%, transparent 55%),
    radial-gradient(2.2px 2.2px at 68% 42%, rgba(255,255,255,0.85) 45%, transparent 55%),
    radial-gradient(1.9px 1.9px at 82% 55%, rgba(255,255,255,0.88) 45%, transparent 55%),
    radial-gradient(2.1px 2.1px at 35% 85%, rgba(255,255,255,0.92) 45%, transparent 55%),
    radial-gradient(1.7px 1.7px at 12% 45%, rgba(255,255,255,0.86) 45%, transparent 55%);
  background-size: auto;
  background-repeat: no-repeat;
  animation: cosmicTwinkle25 25s ease-in-out infinite;
  opacity: .45;
}
html.theme-cosmic .theme-layer::after {
  content:""; position:absolute; inset:auto; pointer-events:none;
  /* Rare faint comet streak (every ~120s) */
  top: 18%; left: -15%; width: 35%; height: 1.5px;
  background: linear-gradient(90deg, rgba(255,255,255,0), rgba(196,167,231,0.25), rgba(255,255,255,0));
  transform: rotate(22deg);
  animation: cosmicComet120 120s linear infinite;
  animation-delay: 15s;
  opacity: 0;
}
html.theme-cosmic .grain {
  background-image:
    radial-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
    radial-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
    linear-gradient(180deg, rgba(18,8,37,0.3) 0%, rgba(5,0,10,0) 100%);
  background-size: 3px 3px, 4px 4px, 100% 100%;
  background-position: 0 0, 1px 1px, 0 0;
  opacity: .18;
  mix-blend-mode: soft-light;
}

/* Plain: Minimal with faint vertical gradient scroll */
html.theme-plain .theme-layer {
  background: var(--theme-gradient);
  background-size: 100% 115%;
  background-position: 50% 0%;
  animation: plainScroll150 150s linear infinite;
  filter: saturate(0.96);
}
html.theme-plain .theme-layer::after {
  content:""; position:absolute; inset:0; pointer-events:none;
  /* Soft radial halo near caret line for focus */
  background: radial-gradient(ellipse 38% 14% at 50% 60%, rgba(196,167,231,0.05) 0%, transparent 65%);
  mix-blend-mode: screen;
  opacity: .5;
}

/* High contrast adjustments while keeping theme identity */
html.high-contrast .theme-layer {
  filter: contrast(1.08) brightness(1.05);
}
html.high-contrast .grain {
  opacity: .3;
}
html.high-contrast.theme-forest .theme-layer::before {
  opacity: .12;
}
html.high-contrast.theme-forest .theme-layer::after {
  opacity: .66;
}
html.high-contrast.theme-ocean .theme-layer::after {
  opacity: .2;
}
html.high-contrast.theme-cosmic .theme-layer::before {
  opacity: .75;
}
html.high-contrast.theme-cosmic .theme-layer::after {
  opacity: .2;
}
html.high-contrast.theme-plain .theme-layer::after {
  opacity: .78;
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  body {
    transition: none !important;
  }

  html.theme-forest .theme-layer,
  html.theme-forest .theme-layer::before,
  html.theme-forest .theme-layer::after,
  html.theme-ocean .theme-layer,
  html.theme-ocean .theme-layer::before,
  html.theme-ocean .theme-layer::after,
  html.theme-cosmic .theme-layer,
  html.theme-cosmic .theme-layer::before,
  html.theme-cosmic .theme-layer::after,
  html.theme-plain .theme-layer,
  html.theme-plain .theme-layer::after,
  .grain {
    animation: none !important;
    transform: none !important;
  }

  html.theme-forest .theme-layer,
  html.theme-cosmic .theme-layer,
  html.theme-plain .theme-layer {
    filter: none !important;
  }

  html.theme-ocean .theme-layer::after {
    opacity: .08 !important;
  }
}
