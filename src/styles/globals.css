@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --rp-base: #191724;
  --rp-surface: #1f1d2e;
  --rp-overlay: #26233a;
  --rp-muted: #6e6a86;
  --rp-subtle: #908caa;
  --rp-text: #e0def4;
  --rp-love: #eb6f92;
  --rp-gold: #f6c177;
  --rp-rose: #ea9a97;
  --rp-pine: #3e8fb0;
  --rp-foam: #9ccfd8;
  --rp-iris: #c4a7e7;
  --rp-hi-low: #21202e;
  --rp-hi-med: #403d52;
  --rp-hi-high: #524f67;
  --shadow-soft: 0 8px 30px rgba(0,0,0,.35);
  --blur: 12px;
  --ease-smooth: cubic-bezier(0.22, 1, 0.36, 1);
  /* Default ambient gradient (Ros√© Pine on OLED-dark) */
  --theme-gradient: linear-gradient(180deg, var(--rp-base) 0%, var(--rp-overlay) 100%);
}

html {
  color-scheme: dark;
}

body {
  background: var(--theme-gradient, var(--rp-base));
  color: var(--rp-text);
  font-family: theme('fontFamily.sans');
  margin: 0;
  padding: 0;
  min-height: 100vh;
  transition: opacity .2s var(--ease-smooth), transform .2s var(--ease-smooth);
}

.glass {
  background: color-mix(in oklab, var(--rp-surface) 80%, transparent);
  backdrop-filter: blur(var(--blur));
  box-shadow: var(--shadow-soft);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 12%, transparent);
}

/* High contrast mode */
html.high-contrast .glass {
  background: color-mix(in oklab, var(--rp-surface) 92%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 35%, transparent);
}
html.high-contrast :focus-visible {
  outline: 3px solid var(--rp-iris);
  outline-offset: 2px;
}

.caret {
  width: 2px;
  animation: blink 0.7s step-end infinite;
}

/* Accent caret for inputs */
.caret-accent { caret-color: var(--rp-iris); }

/* Vignette overlay to add depth on scenes */
.vignette {
  background: radial-gradient(ellipse at center, rgba(0,0,0,0) 60%, rgba(0,0,0,0.32) 100%);
}

/* Ghost buttons (header micro-controls) */
.button-ghost {
  background: color-mix(in oklab, var(--rp-overlay) 55%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 18%, transparent);
  color: var(--rp-subtle);
  transition: background .2s var(--ease-smooth), color .2s var(--ease-smooth), border-color .2s var(--ease-smooth);
}
.button-ghost:hover {
  background: color-mix(in oklab, var(--rp-overlay) 75%, transparent);
  color: var(--rp-text);
  border-color: color-mix(in oklab, var(--rp-iris) 32%, transparent);
}

/* Focus-visible accessibility ring across interactive elements */
:where(a, button, [role="button"], input, select, textarea, [tabindex]):focus-visible {
  outline: 2px solid color-mix(in oklab, var(--rp-iris) 70%, transparent);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px color-mix(in oklab, var(--rp-iris) 18%, transparent);
}

/* Cards: subtle hover animation and glow */
.card {
  @apply rounded-2xl;
  background: color-mix(in oklab, var(--rp-surface) 80%, transparent);
  border: 1px solid color-mix(in oklab, var(--rp-iris) 14%, transparent);
  backdrop-filter: blur(var(--blur));
  box-shadow: var(--shadow-soft);
  transition: transform .2s var(--ease-smooth), background .2s var(--ease-smooth), border-color .2s var(--ease-smooth), box-shadow .2s var(--ease-smooth);
}
.card:hover, .card:focus-visible {
  transform: translateY(-2px) scale(1.01);
  border-color: color-mix(in oklab, var(--rp-iris) 26%, transparent);
  box-shadow: 0 10px 36px rgba(0,0,0,.4);
}

/* Context-aware highlights using :has() (scoped for supporting browsers) */
@supports selector(:has(*)) {
  .glass:has(input:focus-visible),
  .glass:has(textarea:focus-visible),
  .card:has(:focus-visible) {
    border-color: color-mix(in oklab, var(--rp-iris) 28%, transparent);
    box-shadow: 0 0 0 6px color-mix(in oklab, var(--rp-iris) 12%, transparent), var(--shadow-soft);
  }
}

/* Scroll snap utilities (used by Archive overlay lists) */
.snap-y { scroll-snap-type: y proximity; }
.snap-x { scroll-snap-type: x proximity; }
.snap-mandatory { scroll-snap-type: y mandatory; }
.snap-item { scroll-snap-align: start; }

/* Container queries for StatsBar responsive placement */
.stats-cq { container-type: inline-size; }
@container (max-width: 560px) {
  .stats-bar { left: auto; right: 1rem; transform: none; bottom: 1rem; }
  .stats-bar .glass { padding: .5rem .75rem; }
}
@container (min-width: 1000px) {
  .stats-bar .glass { gap: 2rem; }
}

/* Page transitions */
html.page-enter body { opacity: 0.001; transform: translateY(6px); }
html.page-exit body { opacity: 0; transform: translateY(-6px); }

/* Lightweight grain overlay */
.grain {
  background-image:
    radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
    radial-gradient(rgba(0,0,0,0.04) 1px, transparent 1px);
  background-size: 2px 2px, 3px 3px;
  background-position: 0 0, 1px 1px;
  opacity: .25;
  mix-blend-mode: soft-light;
}

/* Theme base layer */
.theme-layer {
  background: var(--theme-gradient, linear-gradient(180deg, var(--rp-base), var(--rp-overlay)));
  filter: none;
}

/* Keyframes */
@keyframes breathe90 { 0%,100%{ filter: brightness(1);} 50%{ filter: brightness(1.04);} }
@keyframes wave20 { 0%{ background-position: 0% 50%, 0% 52%; } 50%{ background-position: 100% 51%, 100% 53%; } 100%{ background-position: 0% 50%, 0% 52%; } }
@keyframes scroll120 { 0%{ background-position: 0 0; } 100%{ background-position: 0 8px; } }
@keyframes hue120 { 0%,100%{ filter: hue-rotate(0deg);} 50%{ filter: hue-rotate(2deg);} }
@keyframes shimmer8 { 0%,100%{ opacity:.06;} 50%{ opacity:.12;} }
@keyframes bubbleUp20 { 0%{ transform: translateY(8%); opacity:0;} 10%{opacity:.10;} 90%{opacity:.10;} 100%{ transform: translateY(-8%); opacity:0;} }
@keyframes leafFloat40 { 0%{ transform: translateY(-3%) translateX(0) rotate(0deg); opacity:.10;} 50%{ transform: translateY(35%) translateX(1.5%) rotate(10deg);} 100%{ transform: translateY(85%) translateX(-1.5%) rotate(-7deg); opacity:0; } }
@keyframes twinkle16 { 0%,100%{ opacity:.35;} 50%{ opacity:.7;} }
@keyframes comet120 { 0%{ opacity:0; transform: translateX(-15%) translateY(-10%) rotate(20deg);} 1%{ opacity:.22;} 3%{ opacity:.18;} 5%{ opacity:0; transform: translateX(115%) translateY(20%) rotate(20deg);} 100%{ opacity:0; } }

/* Forest: pine/foam earth tones, subtle leaf float, soft breathing */
html.theme-forest .theme-layer {
  background-image:
    var(--theme-gradient),
    radial-gradient(ellipse 40% 10% at 20% -10%, color-mix(in oklab,var(--rp-pine) 40%, transparent) 0%, transparent 70%),
    radial-gradient(ellipse 35% 9% at 80% -15%, color-mix(in oklab,var(--rp-foam) 22%, transparent) 0%, transparent 70%),
    linear-gradient(180deg, color-mix(in oklab, var(--rp-pine) 6%, transparent), transparent 40%);
  background-size: cover, 100% 100%, 100% 100%, 100% 100%;
  animation: breathe90 90s ease-in-out infinite;
}
html.theme-forest .theme-layer::before,
html.theme-forest .theme-layer::after {
  content:""; position:absolute; inset:0; pointer-events:none;
  background:
    radial-gradient(12px 6px at 30% -10%, rgba(62,143,176,.10) 40%, transparent 60%),
    radial-gradient(10px 5px at 70% -20%, rgba(156,207,216,.08) 40%, transparent 60%),
    radial-gradient(9px 5px at 50% -15%, rgba(62,143,176,.06) 40%, transparent 60%);
  animation: leafFloat40 40s linear infinite;
}

/* Ocean: layered waves, subtle shimmer, upward bubbles */
html.theme-ocean .theme-layer {
  background-image:
    radial-gradient(circle at 50% 52%, color-mix(in oklab,var(--rp-foam) 10%,transparent), transparent 60%),
    linear-gradient(180deg, color-mix(in oklab,var(--rp-base) 15%, transparent), color-mix(in oklab,var(--rp-overlay) 85%, transparent)),
    linear-gradient(180deg, var(--rp-base), var(--rp-overlay));
  background-size: 200% 200%, 100% 100%, cover;
  background-blend-mode: screen, normal;
  animation: wave20 20s ease-in-out infinite;
}
html.theme-ocean .theme-layer::before { /* Bubbles */
  content:""; position:absolute; inset:0; pointer-events:none;
  background:
    radial-gradient(6px 6px at 20% 90%, rgba(255,255,255,.05) 40%, transparent 60%),
    radial-gradient(4px 4px at 60% 85%, rgba(255,255,255,.04) 40%, transparent 60%),
    radial-gradient(5px 5px at 80% 95%, rgba(255,255,255,.04) 40%, transparent 60%);
  animation: bubbleUp20 20s linear infinite;
}
html.theme-ocean .theme-layer::after { /* Horizon shimmer */
  content:""; position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(180deg, rgba(255,255,255,.05), transparent 35%);
  animation: shimmer8 8s ease-in-out infinite;
}

/* Cosmic: fewer brighter stars, gentle twinkle, rare comet, tiny hue shift */
html.theme-cosmic .theme-layer { animation: hue120 120s ease-in-out infinite; }
html.theme-cosmic .theme-layer::before {
  content:""; position:absolute; inset:0; pointer-events:none;
  background:
    radial-gradient(1.4px 1.4px at 12% 22%, rgba(255,255,255,.95) 50%, transparent 60%),
    radial-gradient(1.6px 1.6px at 35% 68%, rgba(255,255,255,1) 50%, transparent 60%),
    radial-gradient(1.5px 1.5px at 62% 38%, rgba(255,255,255,.95) 50%, transparent 60%);
  animation: twinkle16 16s ease-in-out infinite;
  opacity:.45;
}
html.theme-cosmic .theme-layer::after { /* Rare comet every ~120s */
  content:""; position:absolute; pointer-events:none;
  top:12%; left:-15%; width:35%; height:1px; background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
  transform: rotate(20deg);
  animation: comet120 120s linear infinite;
}

/* Plain: minimal vertical gradient scroll + soft halo at bottom center */
html.theme-plain .theme-layer {
  background: var(--theme-gradient);
  background-size: auto 110%;
  animation: scroll120 120s linear infinite;
}
html.theme-plain .theme-layer::after {
  content:""; position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(ellipse 40% 15% at 50% 70%, rgba(255,255,255,.06), transparent 60%);
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition: none !important;
  }
}
